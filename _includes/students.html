<h1>Master Thesis Students</h1>

<label style="font-size:1.1em;font-weight:bold;">
  Filter by year:
</label>
<select id="yearFilter">
  <option value="all">All years</option>
</select>

<div id="thesis-list"></div>

<hr>

<h2>Thesis Count Per Year</h2>
<div id="yearChart" style="height:400px;"></div>

<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<script>
  const theses = {{ site.data.students | jsonify }};
  const thesisList = document.getElementById("thesis-list");
  const filterSelect = document.getElementById("yearFilter");

  // 1) Collect distinct years and populate dropdown
  const years = [...new Set(theses.map(t => t.year))].sort().reverse();
  years.forEach(y => {
    const opt = document.createElement("option");
    opt.value = y;
    opt.innerText = y;
    filterSelect.appendChild(opt);
  });

  // 2) Render list (filtered or all)
  function renderList(year = "all") {
    const filtered = (year === "all") ? theses : theses.filter(t => t.year == year);

    let html = "<ul>";
    filtered.forEach(t => {
      html += `
        <li>
          <strong>${t.year}</strong> â€”
          <a href="${t.url}" target="_blank">${t.title}</a><br>
          <em>${t.student_name}</em>
        </li>`;
    });
    html += "</ul>";

    thesisList.innerHTML = html;
    renderChart(filtered);
  }

  // 3) Chart dynamically updates based on filtered data
  function renderChart(filtered) {
    const counts = {};
    filtered.forEach(t => counts[t.year] = (counts[t.year] || 0) + 1);

    const plotYears = Object.keys(counts).sort();
    const values = plotYears.map(y => counts[y]);

    const data = [{ x: plotYears, y: values, type: 'bar' }];

    const layout = {
      title: 'Number of Theses (Filtered)',
      xaxis: { title: 'Year' },
      yaxis: { title: 'Theses Count' }
    };

    Plotly.newPlot('yearChart', data, layout);
  }

  // Event listener for dropdown
  filterSelect.addEventListener("change", e => renderList(e.target.value));

  // Initial load with all data
  renderList();
</script>
