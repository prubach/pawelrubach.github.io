<section id="publications" class="section-block">
  <h2 class="section-title">Publications</h2>

  <div id="pub-tabs"></div>
  <div id="pub-list"></div>
  <h4>Download a list of my publications in the <a href="{{ '/assets/data/pawelrubach.bib' | relative_url }}">BIB format here</a></h4>
</section>

<script>
  const publications = {{ site.data.publications | jsonify }};
  const abstracts = {{ site.data.publications_figures | jsonify }};
  const categoryData = {{ site.data.publications_categories | jsonify }};

  const pubList = document.getElementById("pub-list");
  const pubTabs = document.getElementById("pub-tabs");

  const categories = ["All", ...categoryData.categories];
  const assignments = categoryData.assignments;

  /* ---------- BUILD TABS ---------- */
  function renderTabs() {
    pubTabs.innerHTML = categories
      .map((cat, i) =>
        `<div class="pub-tab ${i === 0 ? 'active' : ''}" data-category="${cat}">
          ${cat}
        </div>`
      )
      .join("");

    // Add click handlers
    document.querySelectorAll(".pub-tab").forEach(tab => {
      tab.addEventListener("click", e => {
        document.querySelectorAll(".pub-tab").forEach(t => t.classList.remove("active"));
        e.target.classList.add("active");
        const category = e.target.dataset.category;
        renderPublications(category);
      });
    });
  }

  /* ---------- RENDER PUBLICATION LIST ---------- */
  function renderPublications(category = "All") {
    let html = '<ul class="pub-container">';

    publications.forEach(p => {
      const pubCats = assignments[p.id] || ["Uncategorized"];

      // Filtering: publication passes if ANY category matches
      if (category !== "All" && !pubCats.includes(category)) {
        return;
      }

      const formattedAuthors = p.authors.join(', ');
      const ga = abstracts.find(a => a.id === p.id);

      html += `
        <li class="pub-item">
          <span class="pub-title">${p.title}</span><br>
          <span class="pub-authors">${formattedAuthors}</span><br>
          ${p.journal ? `<span class="pub-journal">${p.journal}</span>` : ""}
          ${p.year ? `<span class="pub-year">${p.year}</span>` : ""}
          ${p.doi ? `<a class="pub-doi" href="https://doi.org/${p.doi}" target="_blank">DOI: ${p.doi}</a>` : ""}
          <br>
          <span class="pub-cat-label">
            Categories: ${pubCats.join(", ")}
          </span>
          ${ga ? `
            <div class="pub-abstract-figure">
              <a href="${ga.url}" target="_blank">
                <img src="/assets/images/graph/${ga.file}" alt="Graphical abstract for ${p.title}">
              </a>
            </div>
          ` : ""}
        </li>
      `;
    });

    html += "</ul>";
    pubList.innerHTML = html;
  }

  // Initialize
  renderTabs();
  renderPublications();
</script>

<style>
  .pub-cat-label {
    display: inline-block;
    margin-top: 4px;
    font-size: 0.8em;
    color: #777;
  }
  .pub-tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
  }

  .pub-tab {
    padding: 6px 14px;
    border-radius: 6px;
    background: #f0f2f6;
    cursor: pointer;
    font-weight: 600;
    transition: background 0.2s;
  }

  .pub-tab.active {
    background: #7c9cc5;
    color: white;
  }

  .pub-tab:hover {
    background: #d6dce6;
  }

  /* old style */

  #publications .pub-container {
    list-style: none;
    margin: 0;
    padding: 0;
  }

  /* Subtle modern bullet marker */
  .pub-item {
    opacity: 0.95;
    padding: 12px 0 12px 20px;
    position: relative;
    border-bottom: 1px solid rgba(0,0,0,0.06);
  }

  .pub-item::before {
    content: "â€¢";
    color: #7c9cc5;     /* Soft muted blue */
    font-size: 20px;
    position: absolute;
    left: 0;
    top: 10px;
  }

  .pub-title {
    font-weight: 700;
    font-size: 1.05em;
    color: #111;
  }

  .pub-authors {
    font-size: 0.92em;
    color: #666;
  }

  .pub-journal {
    font-style: italic;
    font-weight: 700;
    font-size: 0.92em;
    color: #555;
  }

  .pub-year {
    font-size: 0.9em;
    font-weight: 600;
    color: #333;
  }

  .pub-doi {
    font-size: 0.85em;
    color: #5a6b85;
    text-decoration: none;
  }

  .pub-doi:hover {
    text-decoration: underline;
  }

  .pub-abstract-figure {
    margin-top: 10px;
    text-align: left;
  }

  .pub-abstract-figure img {
    max-width: 400px;
    border-radius: 6px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    transition: transform 0.2s ease;
  }

  .pub-abstract-figure img:hover {
    transform: scale(1.03);
  }

  /* Tabs container */
  #pub-tabs {
    display: flex;
    gap: 12px;
    border-bottom: 2px solid #ddd;
    margin-bottom: 20px;
    padding-bottom: 6px;
  }

  /* Individual tab */
  .pub-tab {
    padding: 8px 14px;
    cursor: pointer;
    font-weight: 600;
    font-size: 0.95em;
    color: #555;
    border-radius: 6px 6px 0 0;
    transition: all 0.2s ease;
  }

  /* Hover effect */
  .pub-tab:hover {
    background: #f3f6fa;
    color: #333;
  }

  /* Active tab */
  .pub-tab.active {
    color: #000;
    border-bottom: 3px solid #4979d8; /* Soft blue underline */
    background: #f8f9fb;
  }

</style>

